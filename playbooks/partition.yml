---
- name: Create partition
  hosts: all
  become: true

  tasks:
  # Retrieve the device info so we can define the number, part_start & part_end for the partition
  - name: Read device information of /dev/xvdf
    parted: device=/dev/xvdf unit=MiB
    register: device_info
    no_log: true
  # Retrieves disk list
  - name: get disk list
    shell: "parted -l"
    register: disks
    no_log: true
  # Prints out the available disks
  - name: Display parted list
    debug:
      msg: "{{ disks.stdout.split('\n') }}"
  - pause:
      prompt: "Please enter the device name you wish to use"
      echo: yes
    register: result
  - set_fact:
      device: "{{ result.user_input }}"
    no_log: true
  - debug:
      var: device
  - name: get free space of chosen device
    shell: "parted {{ device }} unit MB print free | grep 'Free Space' | tail -n1 | awk '{print \"Free space: \" $3}'"
    register: freeSpace
  - debug:
    var: freeSpace